{% extends "layout.html" %}
{% block title %}Bhagirath-Knowledge knows no language {% endblock %}

{% block head %}
<style>
	.hlight{background-color:#ffcc00;}
</style>
{% endblock %}

{% block script %}
<script type="text/javascript" Language="JavaScript">
	$(document).ready(function() {
		$('input[@type="text"], textarea').val("");		
		// install the event handler for #debug #output
		$('input[@type="text"], textarea').keydown(kdown).keyup(kup)
		.mousedown(mup).mousemove(mup).mouseup(mup);
		//.mousedown(
		//	update).mousemove(update).mouseup(update);
		// assign the field1 paste event
		$('.replace').click(function(e) {
			$('#input').replaceSelection($(this).title());
			e.preventDefault();
		});
	});
	/******this function handles #debug #output******/
	var memory = '';
	var kmem = '';
	function mup(e) {
		if($(this).getSelection().text != '')  {
			kmem = 'Mouse up, ';
			kup(e);
		}
	}
	function kup(e) {
		// here we fetch our text range object
		var range = $(this).getSelection();
		// just dump the values
		$('#output1').html(
				""
						+ hexdump(kmem, range.text, range.start,
								(range.end != range.start) ? range.end - 1
										: range.end)
						);
	    kmem = '';
	}
	function kdown(e) {
		kmem += e.which + ' ';
	}
	/******this code block is not needed for jQuery fieldSelection
	 this is just to visualize white space in #debug #output********/
	String.prototype.whitespace = (function() {
		if (!RegExp.escape) {
			RegExp.escape = (function() { // RegExp.escape by Simon Wilson & Mark Wubben
				var specials = [ '/', '.', '*', '+', '?', '|', '(', ')', '[',
						']', '{', '}', '\\' ];
				var sRE = new RegExp('(\\' + specials.join('|\\') + ')', 'g');
				return function(text) {
					return text.replace(sRE, '\\$1')
				}
			})();
		}
		var ws = {
			"\r\n" : "¶",
			"\n" : "¶",
			"\r" : "¶",
			"\t" : "&raquo;",
			" " : "&middot;"
		};
		return ($.browser.msie) ? function() {
			// &#8203; to break up our whitespaces doesn't work in IE (it prints a block)
			// but nevertheless he doesn't need it, because he has "word-wrap:break-word;"
			// and therefore he gets his own function
			var s = this;
			$.each(ws, function(i) {
				s = s.replace(new RegExp(RegExp.escape(i), 'g'), this)
			});
			return s;
		} : function() {
			var s = this;
			$.each(ws, function(i) {
				s = s.replace(new RegExp(RegExp.escape(i), 'g'), this
						+ "\u200b")
			});
			return s;
		}

	})();

	function hexdump(key, txt, hi_f, hi_t) {
		var hex = '', tmp;		
		memory += ' ' + key + (txt?'Selected '+txt : '') +  ' <br/>';
		if (txt) {
			/*
			for ( var i = 0, j = txt.length; i <= j; i++) {
				tmp = txt.charCodeAt(i).toString(16);
				if (i == hi_f)
					hex += '<span class="hi">';
				if (i < txt.length)
					hex += ((tmp.length == 2) ? tmp : '0' + tmp);
				else
					hex += "&nbsp;&nbsp;";
				if (i == hi_t)
					hex += '</span>';
				if ((i + 1) % 16 == 0)
					hex += "\n";
				else
					hex += ' ';
			}*/
		}
		return memory;
	}
	$(function() {
	    editTxt('#original_sentence');
		
	    $('span').mouseover( function() {
	        $(this).addClass('hlight');
	    });
	   
	    $('span').mouseout( function() {
	        $(this).removeClass('hlight');
	    });
	});
	
	function editTxt(selector) {
	    $(function() {
	        var newHtml = '';
	        var words = $(selector).text().split(' ');
	        for (i = 0; i < words.length; i++) {
	            newHtml += '<span>' + words[i] + '</span> ';
	        }     
	        $(selector).html(newHtml);
	    });
	}

	var fontSize = 1;
	
	function zoomOut() {
		fontSize += 0.1;
	    document.getElementById("original_sentence").style.fontSize = fontSize + "em";
	    document.getElementById("input").style.fontSize = fontSize + "em";
	    document.getElementById("input").style.fontSize = fontSize + "em";
	    document.getElementById("output").style.fontSize = fontSize + "em";
	}
	
	function zoomIn() {
	    fontSize -= 0.1;
	    document.getElementById("original_sentence").style.fontSize = fontSize + "em";
	    document.getElementById("input").style.fontSize = fontSize + "em";
	    document.getElementById("input").style.fontSize = fontSize + "em";
	    document.getElementById("output").style.fontSize = fontSize + "em";
	}
	
	function OnSubmit()	{
		x = $('#debug').text();
		$('#cmd').val(x);
		document.main_form.action = "/account/translate/{{uid}}/{{curr_id}}/done/"
		return true;
	}

	function OnNext()  {
		document.main_form.action = "/account/translate/{{uid}}/"
	  	return true;
	}

	function Go() {
		document.main_form.action = "/account/translate/{{uid}}/{{curr_id}}/context/"
	  	return true;
	}		
</script>
{% endblock %}

{% block menu %}
	<ul>
		<li><a href="/account/">Home</a></li>
		<li><a href="/account/upload/">Upload File</a></li>
		<li><a href="/account/translate/{{uid}}/">Translate</a></li>
		<li><a href="/account/evaluate/">Evaluate</a></li>
		<li><a href="/account/{{uid}}/settings/">Account Settings</a></li>
		<li><a href="/logout/">Logout</a></li>
	</ul>
{% endblock %}

{% block center_panel_content %}
<form name="main_form" id="main_form" action="." method="post" enctype="multipart/form-data" accept-charset="UTF-8">
{%csrf_token%}
<div id="translate">
	<div class="trans">
	<p>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<button type="button" name="zoomin" id="zoomin" class="zoomin" value="+" onclick="zoomOut();">+</button>
		<button type="button" name="zoomout" id="zoomout" class="zoomout" value="-" onclick="zoomIn();">-</button>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label>View sentence context:</label>
		<select name="context_size" id="context_size">
		 	 <option value="0">No context</option>
			 <option value="1">Little context</option>
		   	 <option value="2">Elaborate context</option>
		</select>
		<button name="go" id="go" class="zoomout" value="go" onclick="Go();">Go!</button>
	</p>
	
	<fieldset>
		<div id="suggest">
		<table width="100%">
			<tr>
				<td>
					<label style="color: #FF7359">Translate this:</label>
					<div class="original" name="original_sentence" id="original_sentence" readonly="readonly">
						 {% if prev_context %}<a style="color: #375552;">{{prev_context}}</a>{% endif %}
						 <a style="font-weight:bold;">{{english}}</a>
						 {% if next_context %}<a style="color: #375552;">{{next_context}}</a>{% endif %}
	   			    </div>
   			    </td>
				<td>
					<label style=" color: #FF7359">Type in translation here:</label>
					<script>CreateCustomHindiTextArea("translated_sentence","",40,10,true);</script>
				</td>
			</tr>	
		</table>
		</div>
		<table>
			<tr>
				<td>
					<button name="submit" id="submit" class="save" onclick="return OnSubmit();">Save Translation</button><img src="/static/images/save.png"/>
					<button type="button" name="reset" id="reset" class="reset" value="reset" onclick="input.value=' '">Reset</button>
					<button name="next" id="next" value="next" class="next" onclick="return OnNext();" >Next</button>
					<button type="button" name="prev_translations" id="prev_translations" class="prev_translations" onclick="previous_TranslationsClicked(this,'previous');">View Alternate Translations</button>
				</td>
			</tr>
		</table>
		<div id="previous" style="display:none;">
		<table width="100%">
			<tr>
				<td valign="top" align="left"><label style="color: #FF7359">Other Translations:</label>
				<div class="prev_div" name="prev_trans" id="prev_trans" style="background-color:#E9E9E9; color:#000000;" readonly="readonly">
				{{machine_translation}}{{other_translations}}</div></td>
			</tr>	
		</table>
	</div>
	</fieldset>	
	</div>
</div>
<div id="debug" style="visibility:hidden">
	<input id="ws" name="ws" type="checkbox" checked="checked"></input>
	<input id="cmd" name="cmd" type="text"></input>
	<pre id="output1"></pre>
	
</div>
</form>
{% endblock %}